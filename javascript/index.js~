var pre_data;
var nodes;
var edges;
var network;

$(function(){
    var add_table_name_empty;
    var add_table;

    add_table_name_empty = function(con_num){
	var table_html = create_table_html_name_empty(con_num);
	$('#con_name_table_field').html(table_html);
    };

    add_table = function(con_num,base_name){
	var table_html = create_table_html(con_num,base_name);
	$('#con_name_table_field').html(table_html);
    };

    $('#con_name_input').on('click', function(){
	var con_num = parseInt($('#con_num').val());
	add_table_name_empty(con_num);
    });

    $('#con_base_name_input').on('click', function(){
	var con_num = parseInt($('#con_num').val());
	var base_name = $('#con_base_name').val();
	add_table(con_num,base_name);
    });

    $('#create_input').on('click', function(){
	var con_num = parseInt($('#con_num').val());
	var user_name;
	for(var i = 0;i < con_num;i++){
	    var input_id = "#con_name_" + i;
	    var con_name = $(input_id).val();
	    user_name = create_container_rest_api(con_name);
	}
	show_container_rest_api(user_name);
    });
};

function create_table_html_name_empty(con_num){
    var re = "<h2> コンテナの名前テーブル </h2>";
    re += '<table border="1" id="con_name_table">';
    re += '<thead><tr><th>名前</th></tr></thead>';
    re += '<tbody>';
    for(var i = 0;i < con_num;i++){
	re += '<tr><td><input id="con_name_' + i + '" type="text"></td></tr>';
    }
    re += '</tbody></table>';
    re += '<button id="create_input" type="button"> コンテナの作成 </button>';
    return re;
}

function create_table_html(con_num,base_name){
    var re = "<h2> コンテナの名前テーブル </h2>";
    re += '<table border="1" id="con_name_table">';
    re += '<thead><tr><th>名前</th></tr></thead>';
    re += '<tbody>';
    for(var i = 0;i < con_num;i++){
	var name = base_name + i;
	re += '<tr><td><input id="con_name_' + i + '" type="text" value="' + name + '"></td></tr>';
    }
    re += '</tbody></table>';
    re += '<button id="create_input" type="button"> コンテナの作成 </button>';
    return re;
}

function create_container_rest_api(con_name){
    var url = './php/draw_net.php?url=http://localhost:9292/api/create_container/' + con_name;
    var xhr = $.ajax({
	type: 'GET',
	url: url,
	dataType: 'text',
	async: false,
	timeout: 30000
    });
    xhr.success(function(){
	console.log("create_container");
    });
    xhr.error(function(data){
	console.log("create_container error");
	console.log(data);
    });
    xhr.complete(function(data){
    });
    return re;
}

function show_container_rest_api(user_name){
    var url = './php/draw_net.php?url=http://localhost:9292/api/show_container';
    var re;
    var xhr = $.ajax({
	type: 'GET',
	url: url,
	dataType: 'text',
	async: false,
	timeout: 30000
    });
    xhr.success(function(data){
	console.log("show_container");
	console.log(data);
    });
    xhr.error(function(data){
	console.log("show_container error");
	console.log(data);
    });
    xhr.complete(function(data){
    });
    return re;
}
